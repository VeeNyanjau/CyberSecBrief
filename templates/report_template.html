<!DOCTYPE html>
<html>

<head>
    <style>
        /* PDF Specific CSS for xhtml2pdf */
        /* Explicitly link 'main_template' to the default layout */
        @page main_template {
            size: A4;
            margin: 2cm;

            /* Define a footer frame */
            @frame footer_frame {
                -pdf-frame-content: footerContent;
                bottom: 1cm;
                margin-left: 2cm;
                margin-right: 2cm;
                height: 1cm;
            }
        }

        /* Define a specific template for the cover page with no footer */
        @page cover_template {
            margin: 0cm;
            /* No footer frame defined here, so it should be blank */
        }

        body {
            font-family: Helvetica, sans-serif;
            line-height: 1.5;
            color: #2c3e50;
        }

        /* Footer Content */
        #footerContent {
            text-align: center;
            font-size: 10pt;
            color: #7f8c8d;
        }

        /* Cover Page Styling */
        .cover-page {
            text-align: center;
            padding-top: 30%;
        }

        .cover-title {
            font-size: 48pt;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .cover-subtitle {
            font-size: 24pt;
            color: #7f8c8d;
            margin-bottom: 50px;
        }

        .cover-date {
            font-size: 14pt;
            color: #34495e;
            margin-top: 100px;
        }

        /* TOC Styling */
        pdftoc {
            color: #000;
        }

        pdftoc a {
            color: #000;
            text-decoration: none;
        }

        /* Content Styling */
        h1 {
            color: #2c3e50;
            font-size: 24pt;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        h2.cat-header {
            color: #2c3e50;
            font-size: 20pt;
            margin-bottom: 15px;
            padding-top: 20px;
            /* Force new page before category */
            page-break-before: always;
        }

        .story {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #bdc3c7;
            /* Prevent breaking stories across pages if possible */
            page-break-inside: avoid;
        }

        .story-title {
            font-size: 14pt;
            font-weight: bold;
            color: #2980b9;
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
        }

        .story-meta {
            font-size: 9pt;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .summary {
            font-size: 11pt;
            text-align: justify;
        }

        .empty-state {
            font-style: italic;
            color: #95a5a6;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <!-- Footer Content (hidden in flow, used by frame) -->
    <div id="footerContent">
        Generated by CyberSecBrief &bull; Page
        <pdf:pagenumber />
    </div>

    <!-- Start with Cover Template -->
    <pdf:nexttemplate name="cover_template" />
    <div class="cover-page">
        <div class="cover-title">CyberSecBrief</div>
        <div class="cover-subtitle">Cybersecurity Trends, Research & Project Ideas</div>
        <div class="cover-date">{{ date }}</div>
    </div>

    <!-- Force Page Break and Switch to Main Template -->
    <pdf:nexttemplate name="main_template" />
    <div style="page-break-after: always;"></div>

    <!-- 2. Table of Contents -->
    <h1>Table of Contents</h1>
    <div>
        <pdf:toc />
    </div>

    <div style="page-break-after: always;"></div>

    <!-- 3. Content Sections -->
    {% set categories = [
    'Emerging Threats & Attack Patterns',
    'Defensive Techniques & Blue Team Strategies',
    'Tools, Frameworks & Open-Source Spotlight',
    'Academic Research & Papers',
    'Vulnerabilities & Exploit Analysis',
    'Security Failures & Postmortems',
    'Ethics, Law & Policy in Cybersecurity',
    'AI, Automation & Cybersecurity',
    'Sector-Specific Security'
    ] %}

    {% for category_name in categories %}
    <h2 class="cat-header">{{ category_name }}</h2>

    {% if stories[category_name] %}
    {% for story in stories[category_name] %}
    <div class="story">
        <a href="{{ story.link }}" class="story-title">{{ story.title }}</a>
        <div class="story-meta">
            {{ story.source }} | {{ story.published.strftime('%Y-%m-%d') }}
        </div>
        <div class="summary">{{ story.clean_summary }}</div>
    </div>
    {% endfor %}
    {% else %}
    <div class="empty-state">No significant updates in this category today.</div>
    {% endif %}

    {% endfor %}

</body>

</html>