<!DOCTYPE html>
<html>

<head>
    <style>
        /* PDF Specific CSS for xhtml2pdf */
        @page {
            size: A4;
            margin: 2cm;

            @bottom-right {
                content: "Page " counter(page);
                font-family: Helvetica, sans-serif;
                font-size: 10pt;
                color: #7f8c8d;
            }

            @bottom-left {
                content: "Generated by CyberSecBrief";
                font-family: Helvetica, sans-serif;
                font-size: 10pt;
                color: #7f8c8d;
            }
        }

        @page cover {
            margin: 0;

            @bottom-right {
                content: "";
            }

            @bottom-left {
                content: "";
            }
        }

        body {
            font-family: Helvetica, sans-serif;
            /* Standard safe font for PDF */
            line-height: 1.5;
            color: #2c3e50;
        }

        /* Cover Page Styling */
        .cover-page {
            height: 100%;
            width: 100%;
            text-align: center;
            padding-top: 30%;
        }

        .cover-title {
            font-size: 48pt;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .cover-subtitle {
            font-size: 24pt;
            color: #7f8c8d;
            margin-bottom: 50px;
        }

        .cover-date {
            font-size: 14pt;
            color: #34495e;
            margin-top: 100px;
        }

        /* TOC Styling */
        pdftoc {
            color: #000;
        }

        pdftoc a {
            color: #000;
            text-decoration: none;
        }

        /* Content Styling */
        h1 {
            color: #2c3e50;
            font-size: 24pt;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        h2.cat-header {
            color: #2c3e50;
            font-size: 20pt;
            margin-bottom: 15px;
            padding-top: 20px;
            page-break-before: always;
            /* Force new page for each category */
        }

        .story {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #bdc3c7;
        }

        .story-title {
            font-size: 14pt;
            font-weight: bold;
            color: #2980b9;
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
        }

        .story-meta {
            font-size: 9pt;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .summary {
            font-size: 11pt;
            text-align: justify;
        }

        .empty-state {
            font-style: italic;
            color: #95a5a6;
            margin-top: 20px;
        }

        /* Helper for page breaks if needed within long lists */
        .keep-together {
            page-break-inside: avoid;
        }
    </style>
</head>

<body>
    <!-- 1. Cover Page -->
    <div class="cover-page">
        <div class="cover-title">CyberSecBrief</div>
        <div class="cover-subtitle">Cybersecurity Trends, Research & Project Ideas</div>
        <div class="cover-date">{{ date }}</div>
    </div>

    <!-- Force page break after cover (xhtml2pdf handles standard CSS page-break) -->
    <div style="page-break-after: always;"></div>

    <!-- 2. Table of Contents -->
    <h1>Table of Contents</h1>
    <div>
        <pdf:toc />
    </div>

    <div style="page-break-after: always;"></div>

    <!-- 3. Content Sections -->
    {% set categories = [
    'Emerging Threats & Attack Patterns',
    'Defensive Techniques & Blue Team Strategies',
    'Tools, Frameworks & Open-Source Spotlight',
    'Academic Research & Papers',
    'Vulnerabilities & Exploit Analysis',
    'Security Failures & Postmortems',
    'Ethics, Law & Policy in Cybersecurity',
    'AI, Automation & Cybersecurity',
    'Sector-Specific Security'
    ] %}

    {% for category_name in categories %}
    <!-- Category Header (H1/H2 for TOC) -->
    <!-- xhtml2pdf usually builds TOC from H1/H2 tags. We'll use H2 styled as main header. -->
    <h2 class="cat-header">{{ category_name }}</h2>

    {% if stories[category_name] %}
    {% for story in stories[category_name] %}
    <div class="story keep-together">
        <a href="{{ story.link }}" class="story-title">{{ story.title }}</a>
        <div class="story-meta">
            {{ story.source }} | {{ story.published.strftime('%Y-%m-%d') }}
        </div>
        <div class="summary">{{ story.clean_summary }}</div>
    </div>
    {% endfor %}
    {% else %}
    <div class="empty-state">No significant updates in this category today.</div>
    {% endif %}

    {% endfor %}

</body>

</html>